name: Set latest
on:
  workflow_run:
    workflows: [Release]
    types: [completed]
    branches: [main]
jobs:
  set-latest:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: get most recent git tag
        run: |
          newestRelease=gh release list --exclude-drafts=true --exclude-pre-releases=true -L=1
          echo "newestRelease" | newestRelease
          echo "tag" | newestRelease.tag
          echo 'NEWEST_TAG='$newestRelease.tag >> $GITHUB_ENV
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: ${{ github.repository_owner }}
          REPO: ${{ github.event.repository.name }}
      - name: set latest tag to most recent tag
        run: |
          gh release edit $NEWEST_TAG --target=main --latest=true --repo $GITHUB_REPOSITORY
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          